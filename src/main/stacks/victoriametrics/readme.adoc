= Victoria Metrics

link:https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html[Doc & Migration Guide]

.Tips:
* link:https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-work-with-snapshots[How to work with snapshots]

- In -storageDataPath directory. 
- Navigate to http://<victoriametrics-addr>:8428/snapshot/create
- List with /snapshot/list

* link:https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-export-time-series[How to export timeseries]

* link:https://docs.victoriametrics.com/vmctl.html[VMCtl - Migration Tool]

== PromQL

* link:https://promlabs.com/promql-cheat-sheet/[PromQL Cheat Sheet]

.In VM UI at http://localhost:8428/vmui/?, write a range query such as below
[source,bash]
----
# Example with modifier specifiying a diff
((sensors_teleinfo_HCHC{} @ 1672552800 - (sensors_teleinfo_HCHC{} @ 1672466400)) / 1000)

# Example with offset to diff relatively 1d
((sensors_teleinfo_HCHP{} - (sensors_teleinfo_HCHP{} offset 1d)) / 1000)
----

== Examples

.Maintenance
[source,bash]
----
# cache cleanups
$ curl 'http://localhost:8428/internal/resetRollupResultCache'
----

.Import/Export
* link:https://docs.victoriametrics.com/#how-to-import-data-in-json-line-format[Doc Export/Import]

[source,bash]
----
# Export
$ curl http://localhost:8428/api/v1/export -d 'match[]={__name__="sensors_zigbee_energy_l1"}' -d 'start=2023-04-24T06:25:48' -d 'end=2023-04-24T06:26:07' | jq .

{
  "metric": {
    "__name__": "sensors_zigbee_energy_l1",
    "db": "sensors",
    "location": "C01~Garage~PowerMeter"
  },
  "values": [
    1282.078,
    1282.078,
    1282.078,
    1282.078
  ],
  "timestamps": [
    1682317553059,
    1682317553844,
    1682317554769,
    1682317555720
  ]
}

# Import
# File contains same as above (but flat line)
$ curl -X POST http://localhost:8428/api/v1/import -T json.import

# WARNING: look at VM logs to see errors because response is always 204 OK
----



